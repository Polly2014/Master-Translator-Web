# 预览功能使用指南

## 📖 功能概述

Master Translator Web 新增了**翻译预览功能**，用户可以在浏览器中直接查看翻译结果，无需下载文件。

## ✨ 主要特性

### 1. **双视图模式**
- **原始文本视图 (Raw Text)**: 显示 Markdown 原始代码，方便检查格式
- **渲染视图 (Rendered)**: 渲染后的 HTML 视图，更易阅读

### 2. **实时统计**
- 字数统计 (Word Count)
- 字符统计 (Character Count)
- 显示在预览窗口底部

### 3. **无缝下载**
- 预览窗口内提供下载按钮
- 无需关闭预览即可下载

### 4. **友好交互**
- 点击背景或 ESC 键关闭预览
- 在原始/渲染视图间快速切换
- 自定义滚动条，美观且易用

## 🎯 使用方法

### 步骤 1: 完成翻译任务
1. 上传 Markdown 文件
2. 选择目标语言
3. 点击 **Analyze Chunks** 分析文档结构
4. 点击 **Start Translation** 开始翻译
5. 等待翻译完成（显示 100% 完成）

### 步骤 2: 打开预览
在翻译完成后，下载面板会显示两个按钮：

```
┌─────────────────────────────┐
│  👁️  Preview Translation    │  ← 新增预览按钮
├─────────────────────────────┤
│  📥  Download Translation   │
└─────────────────────────────┘
```

点击 **Preview Translation** 打开预览窗口。

### 步骤 3: 切换视图

预览窗口顶部有两个切换按钮：

- **Raw Text**: 查看 Markdown 原始文本
- **Rendered**: 查看渲染后的 HTML

点击按钮即可切换视图。

### 步骤 4: 下载或关闭

- **下载**: 点击预览窗口底部的 **Download** 按钮
- **关闭**: 
  - 点击右上角 ❌ 按钮
  - 点击预览窗口外的背景区域
  - 按键盘 **ESC** 键

## 🎨 界面说明

### 预览窗口布局

```
┌────────────────────────────────────────────┐
│  👁️ Translation Preview    [Raw][Rendered]  │  ← 标题栏 + 视图切换
├────────────────────────────────────────────┤
│                                            │
│            翻译内容显示区域                  │
│         （可滚动，自定义滚动条）              │
│                                            │
├────────────────────────────────────────────┤
│  📊 1,234 words • 5,678 characters   [📥]  │  ← 统计信息 + 下载
└────────────────────────────────────────────┘
```

### 原始文本视图
- 等宽字体 (monospace)
- 深色背景
- 保留所有 Markdown 语法
- 适合检查格式和特殊标记

### 渲染视图
- 正文字体 (prose)
- 完整的 Markdown 渲染
  - 标题层级 (H1, H2, H3)
  - 列表 (有序/无序)
  - 引用块
  - 代码块
  - 粗体/斜体
  - 链接
- 适合阅读和校对内容

## 🔧 技术实现

### 前端
- **Marked.js**: Markdown 到 HTML 的渲染
- **Tailwind CSS**: 响应式样式
- **自定义 CSS**: Markdown 渲染样式优化

### 后端
- **Flask 端点**: `/api/preview/<task_id>`
- **返回格式**: JSON
  ```json
  {
    "success": true,
    "content": "# Markdown 内容...",
    "filename": "translated_Japanese.md",
    "language": "Japanese"
  }
  ```

### 样式特性
```css
/* Markdown 渲染样式 */
- 标题渐进大小和颜色
- 引用块左侧蓝色边框
- 代码块深色背景
- 链接蓝色高亮
- 列表正确缩进
- 粗体/斜体样式
```

## 📊 性能优势

### 与下载相比：
| 特性 | 预览 | 下载 |
|------|------|------|
| **查看速度** | ⚡ 即时 | 需要打开本地编辑器 |
| **切换视图** | ✅ 支持 | ❌ 不支持 |
| **无需保存** | ✅ 是 | ❌ 否 |
| **网络占用** | 📶 最小 | 📥 完整文件 |
| **适合场景** | 快速检查 | 本地编辑 |

## 🎯 使用场景

### 1. **快速校对**
- 翻译完成后立即检查
- 无需下载即可发现问题
- 原始视图检查格式

### 2. **演示展示**
- 向客户展示翻译结果
- 切换视图展示不同效果
- 无需下载多个文件

### 3. **质量验证**
- 检查术语一致性
- 验证格式完整性
- 统计字数是否符合要求

### 4. **协作审阅**
- 团队成员在线查看
- 无需分发文件
- 实时反馈修改建议

## 🐛 故障排除

### 问题 1: 预览按钮不显示
**原因**: 翻译尚未完成  
**解决**: 等待翻译进度达到 100%

### 问题 2: 预览窗口空白
**原因**: 网络请求失败或文件读取错误  
**解决**: 
1. 检查浏览器控制台错误
2. 刷新页面重试
3. 检查服务器日志

### 问题 3: 渲染视图显示异常
**原因**: Markdown 语法问题或 marked.js 未加载  
**解决**:
1. 切换到原始视图检查语法
2. 检查浏览器控制台是否有 JS 错误
3. 确认 marked.js CDN 可访问

### 问题 4: 中文字符显示乱码
**原因**: 文件编码问题  
**解决**: 
- 后端使用 `encoding='utf-8'` 读取文件
- 检查原始文件编码是否为 UTF-8

## 🔄 与其他功能的关系

```
上传文件
  ↓
分析分块 (Analyze)
  ↓
开始翻译 (Translate)
  ↓
翻译完成 (100%)
  ↓
┌──────────────┬──────────────┐
│   预览 👁️    │   下载 📥    │
└──────────────┴──────────────┘
```

- **预览优先**: 先预览检查，再决定是否下载
- **独立功能**: 预览不影响下载功能
- **互补使用**: 预览窗口内也可直接下载

## 📝 更新日志

### Version 1.0 (当前版本)
- ✅ 双视图模式 (原始/渲染)
- ✅ 实时统计显示
- ✅ Markdown 完整渲染
- ✅ 响应式设计
- ✅ 键盘快捷键支持
- ✅ 自定义滚动条

### 未来计划
- 🔲 全屏预览模式
- 🔲 打印预览功能
- 🔲 导出 PDF
- 🔲 语法高亮优化
- 🔲 搜索功能
- 🔲 分享链接

## 🎓 最佳实践

1. **先预览再下载**: 节省时间和存储空间
2. **使用双视图**: 原始视图检查格式，渲染视图检查内容
3. **关注统计信息**: 确认字数符合要求
4. **演示时使用**: 比下载文件更专业
5. **移动设备友好**: 响应式设计支持手机/平板

## 🔗 相关文档

- [Master Translator 用户指南](README.md)
- [术语功能指南](TERMINOLOGY_GUIDE.md)
- [Demo 文件指南](DEMO_FILES_GUIDE.md)
- [模型配置指南](MODEL_CONFIG_GUIDE.md)

---

**提示**: 预览功能完全在浏览器中运行，不会产生额外的 API 调用成本！ 🎉
